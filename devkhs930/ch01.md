# 1. 도메인 모델 시작

## 1.1도메인
개발자 입장에서 온라인서점은 구현해야할 대상이 된다.  
온라인 서점 소프트웨어는 온라인으로 책을 파는데 필요한 **상품조회**, **구매**, **결제**, **배송 추적** 등의 기능을 제공한다.  
이때 온라인 서점 소프트웨어로 **해결하려고 하는 문제 영역**이 도메인이다.  

## 하위 도메인
![](../image/devksh930-도메인.png)  
한 도메인은 다시 하위 도메인으로 나뉘어 진다.
- 카탈로그 : 고객에게 구매할수 있는 상품목록 제공
- 주문 : 고객의 주문을 처리
- 혜택 : 특별할인과 같은 서비스 제공
- 배송 : 고객에게 구매한 상품을 전달하는 일련의 과정 처리

하위 도메인 들은 다른 하위 도메인들과 연동하여 완전한 기능을 제공하게 되는데    
고객이 주문을 하게 된다면 주문 -> 결제 -> 배송 --> 혜택 등의 도메인들과 상호작용을 하게 된다.  
온라인서점을 위한 도메인(특정 도메인)이라고 해서 하위도메인의 모든 기능을 이용하는 것이 아닌   
배송, 결제등과 같은 일부기능은 자체 시스템으로 구현하고 나머지기능은 외부 업체의 시스템을 이용한다  


```
하위 도메인 도메인 마다 고정된것이 아니다 상황에 따라 하위도메인을 구성한다
```
### 예시
- 소규모 업체는 엑셀과 같은 도구를 이용해 정산 처리를 한다
- 대형장비를 파는 곳은 온라인으로 카탈로그를 제공하고 주문서 받는정도만 필요한다.



## 1.2 도메인 전문가와 개발자간의 지식 공유
- 개발자는 개발에 앞서 도메인 요구 사항에 대한 올바른 이해를 필요로 한다.
- 요구사항을 올바르게 이해하지 못하면  쓸모가 없거나 유용함이 떨어지는 시스템을 만들 가능성이 높아진다
- 개발자는 도메인 전문가와 직접 대화해 정보의 왜곡을 최소화 한다
- 개발자는 도메인 전문가 만큼은 아니더라도 도메인지식을 갖춰야한다.

## 1.3 도메인 모델 
도메인 모델이란 특정 도메인을 개념적으로 표현한것이다. 도메인 모델을 사용하면 여러 관계자들이 동일한 모습으로 도메인을 이해하고 지식을 공유 하는데 도움이 된다.  
도메인 모델을 표현할 때 클래스 다이어그램,상태다이어그램, UML등의 표기법만 사용해야 하는것이 아닌 구현 기술에 맞는 모델을 통해 도메인 모델을 나타내는 것이 중요하다.

## 1.4 도메인 모델 패턴
#### 일반적인 애플리케이션의 아키텍처
- 사용자 인터페이스 또는 표현 계층(presentation) : 사용자의 요청을 처리하고 정보를 보여준다(사용자는 소프트웨어 사용자 뿐만 아니라 외부시스템일수도 있음)
- 응용 계층(Application) : 사용자가 요청한 기능을 실행 비즈니스로직을 직접 구현하지 않으며 도메인 계층을 조합해 기능 실행
- 도메인 : 시스템이 제공할 도메인 규칙을 구현
- 인프라스트럭쳐(Infrastructure) : 데이터베이스나 메시징시스템등 외부 시스템과 연동을 처리

도메인 모델 패턴은 아키텍처 상의 도메인 계층을 객체 지향 기법으로 구현 하는 패턴을 이야기한다(`엔터프라이즈 애플리케이션 아키텍처 패턴-마틴파울러`)

#### 예제 - 출고전에 배송지를 변경할수 있다, 주문취소는 배송전에만 할수있다
```java
public class Order{
    private OrderState state;
    private ShippingInfo shippingInfo;
    
    public void changeShippingInfo(ShippingInfo newShippingInfo){
        if (!state.isShippingChangeble()) {
            throw new IllegalStateException("can't change shipping in " + state);
        }
        this.shippingInfo = newShippingInfo;
    }
}

public enum OrderState{
    PAYMENT_WAITING{
        public boolean isShippingChangeble(){
            return true;
        }
    },
    PREPARING{
        public boolean isShippingChangeble(){
            return true;
        }
    },
    SHIPPED, DELIVERING, DELIVERY_COMPLETE;
    public boolean isShippingChangeble(){
        return false;
    }
}
```
- 주문 기능의 일부를 도메인 모델패턴으로 구현
- 주문상태를 표현하는 OrderState는 배송상태를 변경할수 있는지에 대한여부를 검증하는 `isShippingChangeble()` 메서드를 구현 하고 있다.
- 핵심 기능을 구현한 코드는 도메인 모델에만 위치하기 때문에 규칙이 바뀌거나 규칙을 확장해야 할 때 다른 코드에 영향을 덜주고 변경내용을 반영할수 있다.


## 1.5 도메인 모델 도출
